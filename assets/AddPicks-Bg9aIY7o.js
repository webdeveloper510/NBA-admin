import{r as c,j as e,C as I}from"./index-3A09cUbM.js";import{b as D}from"./api-C4k75cI7.js";import{R as S}from"./index-CvDgyKB_.js";/* empty css              */import{C as q,a as R}from"./CCardBody-DdaEBaou.js";import{C as P}from"./CCardHeader-Bu22E4w2.js";import{C as d,a as l}from"./CRow-BfEtOW1P.js";import{C as U}from"./CAlert-sFHJNdHb.js";import{C as B}from"./CForm-DJOxvjjk.js";import{C as g}from"./CFormInput-QjOR5tjN.js";import{C}from"./CFormLabel-B_OJKCp0.js";import{C as L}from"./CImage-CsKQDfgG.js";import{a as N}from"./CButton-BYqVqqgt.js";import{C as T}from"./CFormSwitch-DokVNl7G.js";import"./isEqual-CmEGHZs6.js";import"./DefaultLayout-VXqgv9-I.js";import"./CContainer-C94Klz2v.js";import"./index.esm-2A5IUDPe.js";import"./cil-lock-locked-DmxpJbVL.js";import"./CFormControlWrapper-BpSKKtIp.js";import"./CFormControlValidation-nl5jGPsb.js";const oe=({token:V,editMode:f=!1})=>{const[x,v]=c.useState(!1),[m,j]=c.useState({visible:!1,color:"",message:""}),[F,b]=c.useState(!1),[a,o]=c.useState({title:"",price:"",description:"",images:[],imageFiles:[],duration:"",isActive:!0}),[r,p]=c.useState({title:"",price:"",description:"",images:"",duration:""}),u=(s,i)=>{j({visible:!0,color:s,message:i}),setTimeout(()=>j({visible:!1,color:"",message:""}),5e3)},h=s=>{const{name:i,value:t}=s.target;o({...a,[i]:t}),r[i]&&p({...r,[i]:""})},w=s=>{const i=s.target.files;if(i.length>0){const t=Array.from(i).map(n=>({url:URL.createObjectURL(n),filename:n.name,file:n}));o({...a,images:[...a.images,...t],imageFiles:[...a.imageFiles,...i]}),r.images&&p({...r,images:""})}},y=s=>{const i=[...a.images],t=[...a.imageFiles];i.splice(s,1),t.splice(s,1),o({...a,images:i,imageFiles:t})},A=()=>{o({...a,isActive:!a.isActive})},k=()=>{const s={};let i=!0;return a.title.trim()||(s.title="Title is required",i=!1),a.duration.trim()?isNaN(parseFloat(a.duration))&&(s.duration="Duration must be a number",i=!1):(s.duration="Duration is required",i=!1),a.price.trim()?isNaN(parseFloat(a.price))&&(s.price="Price must be a number",i=!1):(s.price="Price is required",i=!1),(!a.description||a.description.trim()===""||a.description==="<p><br></p>")&&(s.description="Description is required",i=!1),a.images.length===0&&(s.images="At least one image is required",i=!1),p(s),i},E=async s=>{if(s.preventDefault(),b(!0),!!k()){v(!0);try{const i=new FormData;i.append("title",a.title),i.append("price",a.price),i.append("duration",a.duration),i.append("description",a.description),i.append("isActive",a.isActive),a.imageFiles.forEach(n=>{i.append("filename",n)});const t=await D(i);t&&t.status===201?(u("success","Media saved successfully!"),o({title:"",price:"",description:"",images:[],imageFiles:[],duration:"",isActive:!0}),b(!1)):u("danger",`Error: ${(t==null?void 0:t.error)||"Failed to save media"}`)}catch(i){u("danger",`Error: ${i.message||"Unknown error"}`)}finally{v(!1)}}};return e.jsxs(q,{className:"mb-4",children:[e.jsx(P,{children:e.jsx(d,{className:"align-items-center",children:e.jsx(l,{children:e.jsx("h3",{children:f?"Edit News":"Add New Pick"})})})}),e.jsxs(R,{children:[m.visible&&e.jsx(U,{color:m.color,children:m.message}),e.jsxs(B,{className:F?"was-validated":"",onSubmit:E,noValidate:!0,children:[e.jsxs(d,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsx(g,{type:"text",name:"title",label:"Title",placeholder:"Enter title",value:a.title,onChange:h,required:!0,invalid:!!r.title,feedbackInvalid:r.title})}),e.jsx(l,{md:6,children:e.jsx(g,{type:"number",name:"price",label:"Price",placeholder:"Enter price",value:a.price,onChange:h,required:!0,invalid:!!r.price,feedbackInvalid:r.price})})]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"duration",className:"form-label",children:"Package Duration"}),e.jsx("input",{type:"number",label:"duration",className:"form-control",id:"duration",placeholder:"",name:"duration",value:a.duration,onChange:h,required:!0,invalid:!!r.duration,feedbackInvalid:r.duration}),r.duration&&e.jsx("div",{className:"invalid-feedback d-block",children:r.duration})]})}),e.jsxs(l,{md:6,children:[e.jsx(C,{children:"Upload Image/Video"}),e.jsx(g,{type:"file",accept:"image/*,video/*",onChange:w,multiple:!0,invalid:!!r.images}),r.images&&e.jsx("div",{className:"invalid-feedback d-block",children:r.images})]})]}),a.images.length>0&&e.jsx(d,{className:"mb-3",children:e.jsx(l,{md:12,children:e.jsx("div",{className:"d-flex flex-wrap gap-2",children:a.images.map((s,i)=>e.jsxs("div",{className:"position-relative",style:{width:"150px"},children:[s.filename.endsWith(".mp4")?e.jsx("video",{width:150,controls:!0,children:e.jsx("source",{src:s.url,type:"video/mp4"})}):e.jsx(L,{src:s.url,width:150,className:"img-thumbnail",alt:"Preview"}),e.jsx(N,{color:"danger",size:"sm",className:"position-absolute",style:{top:"5px",right:"5px"},onClick:()=>y(i),children:"X"})]},i))})})}),e.jsx(d,{className:"mb-3",children:e.jsxs(l,{md:12,children:[e.jsx(C,{htmlFor:"description",children:"Description"}),e.jsx(S,{theme:"snow",value:a.description,onChange:s=>o({...a,description:s}),placeholder:"Enter description",style:{height:"200px",marginBottom:"40px"}}),r.description&&e.jsx("div",{className:"invalid-feedback d-block",children:r.description})]})}),e.jsx(T,{label:"Active",checked:a.isActive,onChange:A}),e.jsx(N,{type:"submit",color:"primary",disabled:x,className:"mt-4",children:x?e.jsx(I,{size:"sm"}):f?"Update":"Save"})]})]})]})};export{oe as default};
