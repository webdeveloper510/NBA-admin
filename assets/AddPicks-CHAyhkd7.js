import{r as n,j as e,C as I}from"./index-Sf5Pd2Ti.js";import{b as S}from"./api-8NfXm4mA.js";import{R as D}from"./index-Dn4AvQ1w.js";/* empty css              */import{C as R,a as q}from"./CCardBody-DteA4Sq5.js";import{C as P}from"./CCardHeader-DqvsIKna.js";import{C as m,a as o}from"./CRow-Lb25VCmc.js";import{C as U}from"./CAlert-CCDvFhTI.js";import{C as B}from"./CForm-DJmEYruh.js";import{C as h}from"./CFormInput-Bx6A_21m.js";import{C as b}from"./CFormLabel-CNJBeCYv.js";import{C as L}from"./CImage-BEoKLxN7.js";import{a as F}from"./CContainer-BMsFnlVt.js";import{C as T}from"./CFormSwitch-CR6CS7zI.js";import"./isEqual-CJuiqw1X.js";import"./DefaultLayout-BvKVTqpM.js";import"./index.esm-BahTF8SP.js";import"./cil-lock-locked-DmxpJbVL.js";import"./CFormControlWrapper-DC2XLO_Y.js";import"./CFormControlValidation-BkgEcxHQ.js";const le=({token:V,editMode:f=!1})=>{const[u,x]=n.useState(!1),[d,v]=n.useState({visible:!1,color:"",message:""}),[w,j]=n.useState(!1),[s,l]=n.useState({title:"",price:"",description:"",images:[],imageFiles:[],isActive:!0}),[r,p]=n.useState({title:"",price:"",description:"",images:""}),g=(a,i)=>{v({visible:!0,color:a,message:i}),setTimeout(()=>v({visible:!1,color:"",message:""}),5e3)},C=a=>{const{name:i,value:t}=a.target;l({...s,[i]:t}),r[i]&&p({...r,[i]:""})},N=a=>{const i=a.target.files;if(i.length>0){const t=Array.from(i).map(c=>({url:URL.createObjectURL(c),filename:c.name,file:c}));l({...s,images:[...s.images,...t],imageFiles:[...s.imageFiles,...i]}),r.images&&p({...r,images:""})}},y=a=>{const i=[...s.images],t=[...s.imageFiles];i.splice(a,1),t.splice(a,1),l({...s,images:i,imageFiles:t})},A=()=>{l({...s,isActive:!s.isActive})},k=()=>{const a={};let i=!0;return s.title.trim()||(a.title="Title is required",i=!1),s.price.trim()?isNaN(parseFloat(s.price))&&(a.price="Price must be a number",i=!1):(a.price="Price is required",i=!1),(!s.description||s.description.trim()===""||s.description==="<p><br></p>")&&(a.description="Description is required",i=!1),s.images.length===0&&(a.images="At least one image is required",i=!1),p(a),i},E=async a=>{if(a.preventDefault(),j(!0),!!k()){x(!0);try{const i=new FormData;i.append("title",s.title),i.append("price",s.price),i.append("description",s.description),i.append("isActive",s.isActive),s.imageFiles.forEach(c=>{i.append("filename",c)});const t=await S(i);t&&t.status===201?(g("success","Media saved successfully!"),l({title:"",price:"",description:"",images:[],imageFiles:[],isActive:!0}),j(!1)):g("danger",`Error: ${(t==null?void 0:t.error)||"Failed to save media"}`)}catch(i){g("danger",`Error: ${i.message||"Unknown error"}`)}finally{x(!1)}}};return e.jsxs(R,{className:"mb-4",children:[e.jsx(P,{children:e.jsx(m,{className:"align-items-center",children:e.jsx(o,{children:e.jsx("h3",{children:f?"Edit News":"Add New Pick"})})})}),e.jsxs(q,{children:[d.visible&&e.jsx(U,{color:d.color,children:d.message}),e.jsxs(B,{className:w?"was-validated":"",onSubmit:E,noValidate:!0,children:[e.jsxs(m,{className:"mb-3",children:[e.jsx(o,{md:6,children:e.jsx(h,{type:"text",name:"title",label:"Title",placeholder:"Enter title",value:s.title,onChange:C,required:!0,invalid:!!r.title,feedbackInvalid:r.title})}),e.jsx(o,{md:6,children:e.jsx(h,{type:"text",name:"price",label:"Price",placeholder:"Enter price",value:s.price,onChange:C,required:!0,invalid:!!r.price,feedbackInvalid:r.price})})]}),e.jsx(m,{className:"mb-3",children:e.jsxs(o,{md:12,children:[e.jsx(b,{children:"Upload Image/Video"}),e.jsx(h,{type:"file",accept:"image/*,video/*",onChange:N,multiple:!0,invalid:!!r.images}),r.images&&e.jsx("div",{className:"invalid-feedback d-block",children:r.images})]})}),s.images.length>0&&e.jsx(m,{className:"mb-3",children:e.jsx(o,{md:12,children:e.jsx("div",{className:"d-flex flex-wrap gap-2",children:s.images.map((a,i)=>e.jsxs("div",{className:"position-relative",style:{width:"150px"},children:[a.filename.endsWith(".mp4")?e.jsx("video",{width:150,controls:!0,children:e.jsx("source",{src:a.url,type:"video/mp4"})}):e.jsx(L,{src:a.url,width:150,className:"img-thumbnail",alt:"Preview"}),e.jsx(F,{color:"danger",size:"sm",className:"position-absolute",style:{top:"5px",right:"5px"},onClick:()=>y(i),children:"X"})]},i))})})}),e.jsx(m,{className:"mb-3",children:e.jsxs(o,{md:12,children:[e.jsx(b,{htmlFor:"description",children:"Description"}),e.jsx(D,{theme:"snow",value:s.description,onChange:a=>l({...s,description:a}),placeholder:"Enter description",style:{height:"200px",marginBottom:"40px"}}),r.description&&e.jsx("div",{className:"invalid-feedback d-block",children:r.description})]})}),e.jsx(T,{label:"Active",checked:s.isActive,onChange:A}),e.jsx(F,{type:"submit",color:"primary",disabled:u,className:"mt-4",children:u?e.jsx(I,{size:"sm"}):f?"Update":"Save"})]})]})]})};export{le as default};
