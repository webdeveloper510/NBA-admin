import{r as c,j as e,C as k}from"./index-DknxvMTE.js";import{b as S}from"./api-B4feELX9.js";import{C as q,a as D}from"./CCardBody-DE43ITNL.js";import{C as P}from"./CCardHeader-CHTVCgvk.js";import{C as m,a as l}from"./CRow-CdQPeIiV.js";import{C as R}from"./CAlert-kEd-hEsG.js";import{C as T}from"./CForm-DIvNSYEC.js";import{C as u}from"./CFormInput-pVSYLVc3.js";import{C as b}from"./CFormLabel--tzb7ppE.js";import{C as U}from"./CImage-qAIfTPJo.js";import{a as F}from"./CContainer-C_J6kvdg.js";import{C as L}from"./CFormTextarea-BZhISeQM.js";import{C as V}from"./CFormSwitch-CX8sd3EM.js";import"./CFormControlWrapper-DSLQ_X7y.js";import"./CFormControlValidation-B0PQQeR_.js";const ie=({token:B,editMode:f=!1})=>{const[x,v]=c.useState(!1),[d,C]=c.useState({visible:!1,color:"",message:""}),[w,j]=c.useState(!1),[s,o]=c.useState({title:"",price:"",description:"",images:[],imageFiles:[],isActive:!0}),[r,p]=c.useState({title:"",price:"",description:"",images:""}),g=(a,i)=>{C({visible:!0,color:a,message:i}),setTimeout(()=>C({visible:!1,color:"",message:""}),5e3)},h=a=>{const{name:i,value:t}=a.target;o({...s,[i]:t}),r[i]&&p({...r,[i]:""})},N=a=>{const i=a.target.files;if(i.length>0){const t=Array.from(i).map(n=>({url:URL.createObjectURL(n),filename:n.name,file:n}));o({...s,images:[...s.images,...t],imageFiles:[...s.imageFiles,...i]}),r.images&&p({...r,images:""})}},A=a=>{const i=[...s.images],t=[...s.imageFiles];i.splice(a,1),t.splice(a,1),o({...s,images:i,imageFiles:t})},y=()=>{o({...s,isActive:!s.isActive})},E=()=>{const a={};let i=!0;return s.title.trim()||(a.title="Title is required",i=!1),s.price.trim()?isNaN(parseFloat(s.price))&&(a.price="Price must be a number",i=!1):(a.price="Price is required",i=!1),s.description.trim()||(a.description="Description is required",i=!1),s.images.length===0&&(a.images="At least one image is required",i=!1),p(a),i},I=async a=>{if(a.preventDefault(),j(!0),!!E()){v(!0);try{const i=new FormData;i.append("title",s.title),i.append("price",s.price),i.append("description",s.description),i.append("isActive",s.isActive),s.imageFiles.forEach(n=>{i.append("filename",n)});const t=await S(i);t&&t.status===201?(g("success","Media saved successfully!"),o({title:"",price:"",description:"",images:[],imageFiles:[],isActive:!0}),j(!1)):g("danger",`Error: ${(t==null?void 0:t.error)||"Failed to save media"}`)}catch(i){g("danger",`Error: ${i.message||"Unknown error"}`)}finally{v(!1)}}};return e.jsxs(q,{className:"mb-4 mt-4",children:[e.jsx(P,{children:e.jsx(m,{className:"align-items-center",children:e.jsx(l,{children:e.jsx("h3",{children:f?"Edit News":"Add New Picks"})})})}),e.jsxs(D,{children:[d.visible&&e.jsx(R,{color:d.color,children:d.message}),e.jsxs(T,{className:w?"was-validated":"",onSubmit:I,noValidate:!0,children:[e.jsxs(m,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsx(u,{type:"text",name:"title",label:"Title",placeholder:"Enter title",value:s.title,onChange:h,required:!0,invalid:!!r.title,feedbackInvalid:r.title})}),e.jsx(l,{md:6,children:e.jsx(u,{type:"text",name:"price",label:"Price",placeholder:"Enter price",value:s.price,onChange:h,required:!0,invalid:!!r.price,feedbackInvalid:r.price})})]}),e.jsx(m,{className:"mb-3",children:e.jsxs(l,{md:12,children:[e.jsx(b,{children:"Upload Image/Video"}),e.jsx(u,{type:"file",accept:"image/*,video/*",onChange:N,multiple:!0,invalid:!!r.images}),r.images&&e.jsx("div",{className:"invalid-feedback d-block",children:r.images})]})}),s.images.length>0&&e.jsx(m,{className:"mb-3",children:e.jsx(l,{md:12,children:e.jsx("div",{className:"d-flex flex-wrap gap-2",children:s.images.map((a,i)=>e.jsxs("div",{className:"position-relative",style:{width:"150px"},children:[a.filename.endsWith(".mp4")?e.jsx("video",{width:150,controls:!0,children:e.jsx("source",{src:a.url,type:"video/mp4"})}):e.jsx(U,{src:a.url,width:150,className:"img-thumbnail",alt:"Preview"}),e.jsx(F,{color:"danger",size:"sm",className:"position-absolute",style:{top:"5px",right:"5px"},onClick:()=>A(i),children:"X"})]},i))})})}),e.jsx(m,{className:"mb-3",children:e.jsxs(l,{md:12,children:[e.jsx(b,{htmlFor:"description",children:"Description"}),e.jsx(L,{id:"description",name:"description",rows:"6",value:s.description,onChange:h,placeholder:"Enter description",required:!0,invalid:!!r.description,feedbackInvalid:r.description})]})}),e.jsx(V,{label:"Active",checked:s.isActive,onChange:y}),e.jsx(F,{type:"submit",color:"primary",disabled:x,className:"mt-4",children:x?e.jsx(k,{size:"sm"}):f?"Update":"Save"})]})]})]})};export{ie as default};
